- package: mnist
  version: 1.5.0
  description: digits
  url: https://github.com/PipelineAI/models
  author: PipelineAI
  author-email: contact@pipeline.ai
  license: Apache 2.0
  tags: [mnist, images, model]

# -------------------------------------------------------------------
# mnist-base (shared config)
# -------------------------------------------------------------------

- config: mnist-base
  operations:
    train:
      description: 'Train'
      # cmd: 'pipeline_train --tpu tpu-us-centra1-c-00 --tpu-zone us-central1-c --gcp-project flux-capacitor1 --data_dir ../input/training --model_dir ./pipeline_tfserving/0 .'
      cmd: 'pipeline_train --model_dir /Users/cfregly/pipelineai/models/tensorflow/mnist-v4/model/checkpoint --export_dir /Users/cfregly/pipelineai/models/tensorflow/mnist-v4/model/pipeline_tfserving --data_dir ../input/'
      flags:
        batch_size:
          description: Number of images to include in a training batch
          default: 1000
        train_epochs:
          description: Number of training epochs  
          default: 1
        epochs_between_evals:
          description: Number of epochs before eval
          default: 1 

    evaluate:
      description: 'Evaluate'
      cmd: 'pipeline_train --test --model_dir /Users/cfregly/pipelineai/models/tensorflow/mnist-v4/model/checkpoint --export_dir /Users/cfregly/pipelineai/models/tensorflow/mnist-v4/model/pipeline_tfserving --data_dir ../input'
      requires:
        - trained-model
  resources:
    trained-model:
      private: yes
      sources:
        - operation: train
          select:
            - model.ckpt.*
            - checkpoint

- model: mnist
  description: official mnist
  extends: mnist-base
  params:
    model_desc: cnn
    train_cmd: pipeline_train
    model_name: mnist
    model_tag: v4
    model_type: tensorflow
    model_runtime: tfserving
    model_chip: cpu
